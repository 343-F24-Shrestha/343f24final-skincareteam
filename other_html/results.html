<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles/styles.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Menu</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="teens.html" class="btn nav-link teens">Teens</a>
                    </li>
                    <li class="nav-item">
                        <a href="adults.html" class="btn nav-link adults">Adults</a>
                    </li>
                    <li class="nav-item">
                        <a href="../index.html" class="btn nav-link home">Home</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5 pt-5">
        <div id="results" class="mt-4"></div>
        <div id="recommendations" class="mt-5">
            <h4>Recommended Products</h4>
            <div id="products-list" class="row mt-3"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Retrieve data from localStorage
        const userName = localStorage.getItem("userName");
        const quizResults = JSON.parse(localStorage.getItem("quizResults"));

        // Display user's name and quiz results
        const resultsDiv = document.getElementById("results");
        if (userName) {
            resultsDiv.innerHTML += `<h1>Hello, ${userName}!</h1>`;
            resultsDiv.innerHTML += `<h2><strong>Your quiz results:</strong></h2>`;
            displayQuizQuestion1Results();
            displayQuizQuestion2Results();
            displayQuizQuestion3Results();
            displayQuizQuestion4Results();
        } else {
            resultsDiv.innerHTML += `<h3>Hello!</h3>`;
        }

        // Function to get the selected value of Question 1 and display a recommendation
        function displayQuizQuestion1Results() {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML += '<h4>1. How would you describe your skin?</h4>';

            if (quizResults) {
                const firstQuestionKey = Object.keys(quizResults)[0];
                const firstQuestionValue = quizResults[firstQuestionKey];

                resultsDiv.innerHTML += `<p><strong>Your answer: </strong>${firstQuestionValue}</p>`;

                switch (firstQuestionValue) {
                    case "Normal":
                        resultsDiv.innerHTML += `<p>Your skin is balanced, so you should focus on maintaining hydration and using lightweight, non-greasy products to keep your skin healthy.</p>`;
                        break;
                    case "Oily":
                        resultsDiv.innerHTML += `<p>For oily skin, it's best to use oil-control products, mattifying moisturizers, and products with salicylic acid to help manage shine and reduce breakouts.</p>`;
                        break;
                    case "Dry":
                        resultsDiv.innerHTML += `<p>Dry skin benefits from hydrating and moisturizing products, such as creams containing hyaluronic acid and ceramides, to help retain moisture and keep your skin smooth.</p>`;
                        break;
                    case "Combination":
                        resultsDiv.innerHTML += `<p>Combination skin requires a balanced approach. Use lightweight, oil-free products on the oily areas and richer moisturizers on the dry areas to maintain harmony.</p>`;
                        break;
                    default:
                        resultsDiv.innerHTML += `<p>We recommend choosing a skin type to get personalized advice!</p>`;
                        break;
                }
            } else {
                resultsDiv.innerHTML += `<p>No quiz results found.</p>`;
            }
        }

        // Function to get the selected value of Question 2 and display a recommendation
        function displayQuizQuestion2Results() {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML += '<h4>2. What is your primary skin concern?</h4>';

            if (quizResults) {
                const secondQuestionKey = Object.keys(quizResults)[1];
                const secondQuestionValue = quizResults[secondQuestionKey];

                resultsDiv.innerHTML += `<p><strong>Your answer: </strong>${secondQuestionValue}</p>`;

                switch (secondQuestionValue) {
                    case "Acne":
                        resultsDiv.innerHTML += `<p>For acne or acne marks, consider products with ingredients like salicylic acid, benzoyl peroxide, or retinol to target blemishes and help fade marks. Products with niacinamide can also help reduce redness and improve overall skin tone.</p>`;
                        break;
                    case "Anti-aging":
                        resultsDiv.innerHTML += `<p>For anti-aging, look for products containing retinoids, peptides, and antioxidants like vitamin C. Hyaluronic acid and ceramides can also help maintain skin elasticity and hydration, reducing the appearance of fine lines and wrinkles.</p>`;
                        break;
                    case "Dryness":
                        resultsDiv.innerHTML += `<p>For dryness or flaky skin, opt for rich moisturizers with ingredients like hyaluronic acid, ceramides, and shea butter. Avoid harsh cleansers, and consider using a gentle exfoliant to remove flaky skin while keeping it hydrated.</p>`;
                        break;
                    case "Texture":
                        resultsDiv.innerHTML += `<p>For improving skin texture, look for products containing exfoliating ingredients such as alpha hydroxy acids (AHAs) like glycolic acid or beta hydroxy acids (BHAs) like salicylic acid. These can smooth the skin's surface and promote cell turnover.</p>`;
                        break;
                    default:
                        resultsDiv.innerHTML += `<p>We recommend choosing a skin concern to get personalized advice!</p>`;
                        break;
                }
            }
        }

        // Function to get the selected value of question 3 and display a recommendation
        function displayQuizQuestion3Results() {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML += '<h4>3. Is your skin sensitive?</h4>';

            if (quizResults) {
                const thirdQuestionKey = Object.keys(quizResults)[2];
                const thirdQuestionValue = quizResults[thirdQuestionKey];

                resultsDiv.innerHTML += `<p><strong>Your answer: </strong>${thirdQuestionValue}</p>`;

                switch (thirdQuestionValue) {
                    case "Yes":
                        resultsDiv.innerHTML += `<p>Use fragrance-free and hypoallergenic products to avoid irritation. Look for calming ingredients like aloe vera, colloidal oatmeal, and chamomile. Always patch-test new products and protect your skin with a gentle mineral sunscreen.</p>`;
                        break;
                    case "No":
                        resultsDiv.innerHTML += `<p>While your skin may be resilient, avoid overusing harsh products. Incorporate active ingredients like retinoids or exfoliants gradually to maintain your skin's barrier. Regular hydration is key!</p>`;
                        break;
                    default:
                        resultsDiv.innerHTML += `<p>We recommend selecting whether your skin is sensitive to get personalized advice!</p>`;
                        break;
                }
            }
        }

        // Function to get the selected value of question 4 and display a recommendation
        function displayQuizQuestion4Results() {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML += '<h4>4. What is your environment like?</h4>';

            if (quizResults) {
                const fourthQuestionKey = Object.keys(quizResults)[3];
                const fourthQuestionValue = quizResults[fourthQuestionKey];

                resultsDiv.innerHTML += `<p><strong>Your answer: </strong>${fourthQuestionValue}</p>`;

                switch (fourthQuestionValue) {
                    case "Dry climate":
                        resultsDiv.innerHTML += `<p>In dry environments, prioritize hydration with rich moisturizers containing ceramides, hyaluronic acid, and glycerin. Use a humidifier at home and protect your skin with occlusive products like balms or oils to lock in moisture.</p>`;
                        break;
                    case "Humid climate":
                        resultsDiv.innerHTML += `<p>In humid climates, opt for lightweight, non-comedogenic products to avoid clogged pores. Gel-based moisturizers and water-based sunscreens are ideal. Incorporate a gentle cleanser to remove excess oil and sweat without stripping the skin.</p>`;
                        break;
                    default:
                        resultsDiv.innerHTML += `<p>We recommend selecting a climate to get personalized advice!</p>`;
                        break;
                }
            }
        }

        // Function to map quiz results to Amazon search terms
        function mapQuizToSearchTerms(quizResults) {
            const searchTerms = [];
            if (quizResults.skinType) searchTerms.push(quizResults.skinType + " skincare");
            if (quizResults.primaryConcern) searchTerms.push(quizResults.primaryConcern + " treatment");
            if (quizResults.sensitivity) searchTerms.push(quizResults.sensitivity + " products");
            if (quizResults.currentProducts) {
                quizResults.currentProducts.split(", ").forEach((product) => {
                    searchTerms.push(product + " skincare");
                });
            }
            return searchTerms;
        }

        // Function to fetch product recommendations from ASIN API
        async function fetchRecommendations(searchTerm) {
            // const apiKey = "DB4E5A4AAA024F44BEBAF9E24008CF54"; // Replace with ASIN API key
            const url = `https://api.asindataapi.com/request?api_key=${apiKey}&type=search&amazon_domain=amazon.com&search_term=${encodeURIComponent(
                searchTerm
            )}&sort_by=average_review`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data && data.search_results) {
                    return data.search_results;
                } else {
                    console.error("No results found for search term:", searchTerm);
                    return [];
                }
            } catch (error) {
                console.error("Error fetching recommendations:", error);
                return [];
            }
        }

        // Function to render product recommendations
        function renderRecommendations(products) {
            const productsList = document.getElementById("products-list");
            productsList.innerHTML = ""; // Clear existing content

            if (products.length === 0) {
                productsList.innerHTML = `<p>No recommendations available at the moment.</p>`;
                return;
            }

            products.forEach((product) => {
                const productCard = `
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <img src="${product.image}" class="card-img-top" alt="${product.title}">
                            <div class="card-body">
                                <h5 class="card-title">${product.title}</h5>
                                <p class="card-text">Price: ${product.price ? product.price.raw : "Not Available"}</p>
                                <a href="${product.link}" class="amz-btn" target="_blank">View on Amazon</a>
                            </div>
                        </div>
                    </div>
                `;
                productsList.innerHTML += productCard;
            });
        }

        // Main function to display recommendations
        async function displayRecommendations() {
            if (!quizResults) return;

            const searchTerms = mapQuizToSearchTerms(quizResults);
            const allProducts = [];

            for (const term of searchTerms) {
                const products = await fetchRecommendations(term);
                allProducts.push(...products);
            }

            // Limit the results to the first 5 products
            const topProducts = allProducts.slice(0, 5);

            // Render the product recommendations
            renderRecommendations(topProducts);
        }

        // Call the function to display recommendations
        displayRecommendations();
    </script>
</body>

</html>